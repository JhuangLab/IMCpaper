{
  "hash": "503acc9aa95c318448a35b11067fbb92",
  "result": {
    "engine": "knitr",
    "markdown": "# sup_figure13\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npkgs <- c(\"fs\", \"futile.logger\", \"configr\", \"stringr\", \"ggpubr\", \"ggthemes\",\n          \"vroom\", \"jhtools\", \"glue\", \"openxlsx\", \"ggsci\", \"patchwork\", \"cowplot\",\n          \"tidyverse\", \"dplyr\", \"Seurat\", \"harmony\", \"ggpubr\", \"GSVA\", \"EnhancedVolcano\",\n          \"monocle\")\nsuppressMessages(conflicted::conflict_scout())\nfor (pkg in pkgs){\n  suppressPackageStartupMessages(library(pkg, character.only = T))\n}\nres_dir <- \"./results/sup_figure13\" %>% checkdir\ndat_dir <- \"./data\" %>% checkdir\nconfig_dir <- \"./config\" %>% checkdir\n\n#colors config\nconfig_fn <- glue::glue(\"{config_dir}/configs.yaml\")\nscrna_cols <- jhtools::show_me_the_colors(config_fn, \"scrna_cells\")\nscmac_type <- jhtools::show_me_the_colors(config_fn, \"scmac_type\")\n\n#read in coldata\nsce_mac <- read_rds(glue::glue(\"{dat_dir}/sce_mac_DNp50_retsne.rds\"))\nsce_all <- read_rds(glue::glue(\"{dat_dir}/sce_all_merge.rds\"))\nmonocle2_obj <- read_rds(glue::glue(\"{dat_dir}/sc_mac_monocle2.rds\"))\n```\n:::\n\n\n\n\n\n\n## sup_figure13a\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2024)\nids <- sample(1:dim(sce_all)[2], 10000)\nsesub <- sce_all[,ids]\n\np <- DimPlot(sesub, reduction = \"tsne\", group.by = \"cell_types2\",\n             label = F, cols = scrna_cols, combine = F, pt.size = .001)\np <- p[[1]] +\n  guides(color = guide_legend(keywidth = unit(0, \"cm\"),\n                             keyheight = unit(0, \"cm\"),\n         nrow = 3, byrow = T)) +\n  theme(plot.title = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_text(size = 8),\n        axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        panel.background = element_blank(),\n        panel.border = element_blank(),\n        panel.spacing = unit(0, \"mm\"),\n        plot.margin = margin(0,0,0,0),\n        plot.background = element_blank(),\n        legend.margin = margin(0,0,0,0),\n        legend.box.margin = margin(0,0,0,0),\n        legend.spacing.y = unit(0, \"mm\"),\n        legend.spacing.x = unit(0, \"mm\"),\n        legend.position = \"top\",\n        legend.text = element_text(size = 6, margin = margin(-.5,-5,0,1)))\nprint(p)\n```\n\n::: {.cell-output-display}\n![](sup_figure13_files/figure-html/sup_figure13a-1.png){width=480}\n:::\n:::\n\n\n\n\n\n\n## sup_figure13b\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIdents(sce_all) <- \"cell_types2\"\n\np <- DotPlot(sce_all, features = c('EPCAM', 'KRT19', 'CPA1', 'VWF', 'ACTA2','PTPRC',\n                                             'CD3D', 'CD4', 'CD8A', 'CD79A', 'MS4A1','XBP1',\n                                             'CD68', 'HLA-DRA', 'HLA-DRB5', 'CD163', 'CD14',\n                                             'FCGR3A', 'FCGR3B', 'CEACAM3', 'CD1C',\n                                             'BATF3', 'TPSAB1','KIT'), #scale = F,\n             dot.scale = 3) + RotatedAxis() + theme_bmbdc() +\n  scale_colour_gradientn(colours = c(\"grey\", \"#ffe5e5\", \"#ff7f7f\", \"#ff6666\", \"#ff0000\"),\n                         values = scales::rescale(x = c(0, 1, 2, 3, 3.5), from = c(0, 3.5))) +\n  guides(size = guide_legend(title = \"Percent Expressed\", keywidth = unit(1, \"cm\"),\n                             keyheight = unit(.2, \"cm\"), nrow = 2, byrow = T)) +\n  guides(color = guide_colorbar(title = \"Expression\", barwidth = unit(1, \"cm\"), barheight = unit(.2, \"cm\"))) +\n  theme(axis.text = element_text(size = 6),\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        panel.background = element_blank(),\n        panel.border = element_blank(),\n        panel.spacing = unit(0, \"mm\"),\n        plot.margin = margin(0,0,0,0),\n        plot.background = element_blank(),\n        legend.box.margin = margin(0,0,0,0),\n        legend.spacing.y = unit(0, \"mm\"),\n        legend.spacing.x = unit(0, \"mm\"),\n        legend.key.size = unit(.2, 'cm'),\n        axis.text.x = element_text(angle = 25, vjust = 1, hjust = 1),\n        #axis.text.y = element_text(angle = 10),\n        axis.line.x = element_line(linewidth = 0.4),\n        axis.line.y = element_line(linewidth = 0.4),\n        legend.margin = margin(0,0,0,0),\n        legend.title = element_text(size=6, margin = margin(-.5,-5,0,1)),\n        legend.text = element_text(size=6, margin = margin(-.5,-5,0,1)),\n        legend.position = \"top\")\n\nprint(p)\n```\n\n::: {.cell-output-display}\n![](sup_figure13_files/figure-html/sup_figure13b-1.png){width=576}\n:::\n:::\n\n\n\n\n\n\n## sup_figure13c\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmplec_col <- c(\"#5D9D58\", \"#7E9A51\", \"#a9d169\", \"#BBA082\",\n                         \"#BEA278\", \"#FFA428\", \"#F4C321\", \"#db9721\",\n                         \"#ecd400\", \"#A56F95\", \"#BAA4CB\", \"#BCBDDC\",\n                         \"#DDBE91\", \"#404BA5\", \"#568AC2\", \"#86BBDA\",\n                         \"#B9E0EE\", \"#E6939F\", \"#B61932\", \"#F98354\",\n                         \"#dbdb8d\", \"#74DA00\", \"#49BADB\", \"#d9d9d9\")\n                         \nIdents(sce_mac) <- \"cell_types3\"\nsce_mac$orig.ident <- str_replace_all(sce_mac$orig.ident, \"DAC_TISSUE_\", \"\")\n\np1 <- DimPlot(sce_mac, reduction = \"tsne\", group.by = \"orig.ident\", pt.size = .001,\n             label = F, cols = smplec_col, combine = F)\np1 <- p1[[1]] +\n  guides(color = guide_legend(keywidth = unit(0, \"cm\"),\n                              keyheight = unit(0, \"cm\"),\n                              nrow = 2, byrow = T)) +\n  theme(plot.title = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_text(size = 8),\n        axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        panel.background = element_blank(),\n        panel.border = element_blank(),\n        panel.spacing = unit(0, \"mm\"),\n        plot.background = element_blank(),\n        plot.margin = margin(1,1,1,1),\n        legend.margin = margin(0,0,0,0),\n        legend.box.margin = margin(0,0,0,0),\n        legend.spacing.y = unit(0, \"mm\"),\n        legend.spacing.x = unit(0, \"mm\"),\n        legend.position = \"top\",\n        legend.text = element_text(size = 6, margin = margin(-2,-5,0,1)))\n\n\np2 <- DimPlot(sce_mac, reduction = \"tsne\", group.by = \"cell_types3\", pt.size = .001,\n             label = F, cols = scmac_type, combine = F)\np2 <- p2[[1]] +\n  guides(color = guide_legend(keywidth = unit(0, \"cm\"),\n                              keyheight = unit(0, \"cm\"),\n         nrow = 2, byrow = T)) +\n  theme(plot.title = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_text(size = 8),\n        axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        panel.background = element_blank(),\n        panel.border = element_blank(),\n        panel.spacing = unit(0, \"mm\"),\n        plot.background = element_blank(),\n        plot.margin = margin(1,1,1,1),\n        legend.margin = margin(0,0,0,0),\n        legend.box.margin = margin(0,0,0,0),\n        legend.spacing.y = unit(0, \"mm\"),\n        legend.spacing.x = unit(0, \"mm\"),\n        legend.position = \"top\",\n        legend.text = element_text(size = 6, margin = margin(-4,-5,0,1)))\np1 | p2\n```\n\n::: {.cell-output-display}\n![](sup_figure13_files/figure-html/sup_figure13c-1.png){width=912}\n:::\n:::\n\n\n\n\n\n\n## sup_figure13d\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npl <- list()\nfor (i in c(\"CD68\", \"SPP1\", \"C1QC\", \"FCN1\", \"CCL18\", \"MT1G\")) {\n  #pdf(glue::glue(\"{res_dir}/sfig13d_sce_mac_{i}_exp_featureplot.pdf\"), width = 2.5, height = 2)\n  pl[[i]] <- FeaturePlot(sce_mac, reduction = \"tsne\", features = i,\n                   order = T, pt.size = .001, combine = F)\n  pl[[i]] <- pl[[i]][[1]] +\n    guides(color = guide_colourbar(barwidth = unit(.1, \"cm\"),\n                                   barheight = unit(.6, \"cm\"),\n                                   title = i,\n                                   title.position = \"top\")) +\n    theme(plot.title = element_blank(),\n          axis.text = element_blank(),\n          axis.title = element_text(size = 8),\n          axis.line = element_blank(),\n          axis.ticks = element_blank(),\n          panel.spacing = unit(0, \"mm\"),\n          panel.border = element_rect(fill = NA, colour = NA),\n          plot.background = element_rect(fill = NA, colour = NA),\n          plot.margin = margin(0,0,0,0),\n          legend.position = c(0,.8),\n          legend.margin = margin(0,0,0,0),\n          legend.title = element_text(size = 6),\n          legend.text = element_text(size = 6))\n  #print(pl[[i]])\n  #dev.off()\n}\n(pl[[1]] | pl[[2]])/(pl[[3]] | pl[[4]])/(pl[[5]] | pl[[6]])\n```\n\n::: {.cell-output-display}\n![](sup_figure13_files/figure-html/sup_figure13d-1.png){width=480}\n:::\n:::\n\n\n\n\n\n\n## sup_figure13e\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#monocle2\n#pdf(glue::glue(\"{res_dir}/sfig13e1_monocle2.pdf\"),width = 3,height = 3)\np1 <- plot_cell_trajectory(monocle2_obj, color_by=\"Pseudotime\", cell_size=.1,\n                          show_backbone=TRUE, cell_name_size = .5, state_number_size = 1) +\n  theme(axis.text = element_text(size = 6, colour = \"black\"),\n        axis.title = element_text(size = 8, colour = \"black\"),\n        axis.line.x = element_line(linewidth = 0.4, colour = \"black\"),\n        axis.line.y = element_line(linewidth = 0.4, colour = \"black\"),\n        legend.key.height = unit(.2, \"cm\"),\n        legend.key.width = unit(.15, \"cm\"),\n        legend.title = element_text(size = 8),\n        legend.text = element_text(size = 6))\n\n#pdf(glue::glue(\"{res_dir}/sfig13e2_monocle2.pdf\"),width = 3, height = 3)\np2 <- plot_cell_trajectory(monocle2_obj, color_by=\"cell_types3\", cell_size=.1,\n                          show_backbone=TRUE) +\n  scale_color_manual(values = scmac_type) + theme(legend.position = \"right\") +\n  theme(axis.text = element_text(size = 6, colour = \"black\"),\n        axis.title = element_text(size = 8, colour = \"black\"),\n        axis.line.x = element_line(linewidth = 0.4, colour = \"black\"),\n        axis.line.y = element_line(linewidth = 0.4, colour = \"black\"),\n        legend.key.height = unit(.2, \"cm\"),\n        legend.key.width = unit(.15, \"cm\"),\n        legend.position = \"top\",\n        legend.margin = margin(0,0,0,0),\n        legend.box.margin = margin(0,0,0,0),\n        legend.spacing.y = unit(0, \"mm\"),\n        legend.spacing.x = unit(0, \"mm\"),\n        legend.title = element_text(size = 8),\n        legend.text = element_text(size = 6, margin = margin(-5,-5,0,1)))\n\n#pdf(glue::glue(\"{res_dir}/sfig13e3_monocle2.pdf\"),width = 8, height = 8)\np3 <- plot_cell_trajectory(monocle2_obj, cell_size=.1, color_by = \"cell_types3\") +\n  facet_wrap(\"~cell_types3\", nrow = 3) +\n  scale_color_manual(values = scmac_type) +\n  theme(axis.text = element_text(size = 6, colour = \"black\"),\n        axis.title = element_text(size = 8, colour = \"black\"),\n        axis.line.x = element_line(linewidth = 0.4, colour = \"black\"),\n        axis.line.y = element_line(linewidth = 0.4, colour = \"black\"),\n        legend.position = \"none\")\n\np <- (p1|p2)/(p3) + plot_layout(heights = c(0.8, 3))\nprint(p)\n```\n\n::: {.cell-output-display}\n![](sup_figure13_files/figure-html/sup_figure13e-1.png){width=576}\n:::\n:::\n",
    "supporting": [
      "sup_figure13_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}